#!/usr/bin/env ruby

require 'chatr'

port = ARGV[0]

chatr = Chatr::Host.new port

puts "Chat server initiated at #{chatr.local_ip} on port #{port}"
while true
  session = select(@connections,nil, nil,nil)
  if session != nil
    session[0].each do |socket|
      if socket == @serverSocket
        chatr.accept_new_connection
      else
        input = socket.gets
        if input.chomp == "EOF"
          chatr.client_quit socket
        else
          chatr.write_out input, socket
        end
      end
    end
  end
end

